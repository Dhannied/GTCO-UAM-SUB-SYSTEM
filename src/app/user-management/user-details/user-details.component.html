<div class="user-details-container">
  <!-- Debugging message -->
  <div *ngIf="!user" style="color: red; padding: 20px;">
    User not found. ID: {{userId}}
  </div>
  
  <!-- Use the shared sidebar component -->
  <app-sidebar activeRoute="user-management"></app-sidebar>

  <!-- Main Content -->
  <div class="main-content" *ngIf="user">
    <!-- Header with back button -->
    <div class="details-header">
      <a (click)="goBack()" class="back-button">
        <i class="fas fa-arrow-left"></i> Back to User Management
      </a>
    </div>

    <!-- User Profile Section -->
    <div class="profile-section">
      <div class="profile-card">
        <div class="profile-header">
          <div class="profile-left">
            @if (user.photo) {
              <img [src]="user.photo" alt="{{ user.name }}" class="profile-avatar">
            } @else {
              <div class="profile-initials">{{ getInitials(user.name || '') }}</div>
            }
            <h2>{{ user.name }}</h2>
            <p class="user-id">#{{ user.employeeId }}</p>
          </div>
          
          <div class="profile-details">
            <div class="detail-item">
              <h3>Email</h3>
              <p>{{ user.email }}</p>
            </div>
            
            <div class="detail-item">
              <h3>Phone</h3>
              <p>{{ user.phone || '+234 9013274980' }}</p>
            </div>
            
            <div class="detail-item">
              <h3>Join Date</h3>
              <p>{{ user.joinDate || '2020-03-15' }}</p>
            </div>
            
            <div class="detail-item">
              <h3>Position</h3>
              <p>{{ user.role }}</p>
            </div>
          </div>
        </div>
        <!-- Removed the last-active div -->
      </div>
    </div>

    <!-- Application Access Section -->
    <div class="applications-section">
      <div class="section-header">
        <div class="header-with-search">
          <h2>Application Access</h2>
          <div class="app-search-box">
            <i class="fas fa-search search-icon"></i>
            <input 
              type="text" 
              placeholder="Search applications..." 
              [(ngModel)]="appSearchTerm"
              (input)="filterApplications()"
            >
            <button *ngIf="appSearchTerm" class="clear-search" (click)="clearAppSearch()">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>
      
      <div class="applications-table">
        <div class="table-header">
          <div class="col application-col">Application</div>
          <div class="col action-col">Action</div>
        </div>
        
        <div class="table-body">
          @if (filteredApplications && filteredApplications.length > 0) {
            @for (app of filteredApplications; track app.id) {
              <div class="table-row">
                <div class="col application-col">
                  <div class="app-info">
                    <div class="app-icon" [style.background-color]="app.iconBg">
                      <i class="fas fa-{{ app.icon }}"></i>
                    </div>
                    <div class="app-details">
                      <div class="app-name">{{ app.name }}</div>
                      <div class="app-platform">{{ app.platform }}</div>
                    </div>
                  </div>
                </div>
                
                <div class="col action-col">
                  @if (app.status === 'Active') {
                    <button class="revoke-btn" (click)="revokeAccess(app.id)">
                      Revoke
                    </button>
                  } @else {
                    <button class="grant-btn" (click)="grantAccess(app.id)">
                      Grant Access
                    </button>
                  }
                </div>
              </div>
            }
          } @else {
            <div class="no-applications">
              @if (appSearchTerm) {
                <p>No applications match your search.</p>
              } @else {
                <p>No applications found for this user.</p>
              }
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Audit Log Section -->
    <div class="audit-log-section">
      <div class="section-header">
        <div class="header-with-filters">
          <h2>Deactivation History</h2>
          <div class="date-filter">
            <select [(ngModel)]="auditDateFilter" (change)="filterAuditLogs()">
              <option value="all">All Time</option>
              <option value="today">Today</option>
              <option value="week">Last 7 Days</option>
              <option value="month">Last 30 Days</option>
              <option value="quarter">Last 90 Days</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="audit-log-container">
        <app-audit-log-table 
          [logs]="filteredAuditLogs"
          [showEmployee]="true"
          [showReason]="true"
          [showDuration]="true"
          [showPagination]="false"
          [showOfficer]="false"
          [maxHeight]="'300px'"
        ></app-audit-log-table>
      </div>
    </div>
  </div>
</div>

<!-- Access Grant Modal -->
<!-- <div class="modal-overlay" *ngIf="showAccessModal">
  ...
</div> -->






